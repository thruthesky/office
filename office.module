<?php
use Drupal\office\Entity\Group;
use Drupal\office\Entity\Member;
use Drupal\office\x;
if ( ! function_exists('di') ) {
	function di( $obj ) { echo "<pre>"; print_r($obj); echo "</pre>"; }
}


function office_theme() {
	$themes = [];
	$names = [
		'office', 'login', 'mydesk',
		'member.list', 'member.view', 'member.edit',
		'task.edit','task.list', 'task.view',
		'group.edit', 'group.list', 'group.workinghours',
		'attendance.list',
		'process.edit', 'process.list',
	];
	foreach($names as $name) {
		$themes[ $name ] = [
			'variables' => [ 'data' => null],
			'template' => $name,
		];
	}
	return $themes;
}




function office_preprocess(&$variables, $hook)
{
	$request = \Drupal::request();
	$uri = $request->getRequestUri();
	if ( ! x::isOfficePage() ) return;

	$variables['office_module'] = 1;


	if ( x::in('uid') ) $variables['member'] = Member::loadByUserID(x::in('uid'));
	if ( x::myUid() ) $variables['my'] = Member::loadByUserID(x::myUid());
	if ( x::in('code') ) $variables['data']['code'] = x::in('code');
	if ( x::in('message') ) $variables['data']['message'] = x::in('message');

	$variables['input'] = x::input();
	$variables['office'] = x::officeInformation();
	$variables['priority'] = x::priority();
	$variables['groups'] = Group::loadMultiple();


	if ( $hook == 'page' ) {
		// x::gs(2);
	}

	$variables['dir_office'] = drupal_get_path('module', 'office');

	$variables['#attached']['library'][] = 'office/default';
	if ( x::isOfficeMemberPage() ) {
		$variables['#attached']['library'][] = 'office/member';
	}
	$variables['data']['class']['office'][] = 'office';
	$variables['data']['class']['office'][] = $hook;

}




